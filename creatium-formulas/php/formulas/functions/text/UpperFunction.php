<?php

namespace formulas\functions\text;

use Exception;
use formulas\ExpressionNode;
use formulas\functions\AbstractFunction;
use formulas\Typing;

class UpperFunction extends AbstractFunction
{
    protected int $minArguments = 1;
    protected int $maxArguments = 1;

    // https://www.ibm.com/docs/en/i/7.2?topic=tables-unicode-lowercase-uppercase-conversion-mapping-table
    static $TABLE = [
        'lower' => [
            "\u{0061}", "\u{0062}", "\u{0063}", "\u{0064}", "\u{0065}", "\u{0066}", "\u{0067}", "\u{0068}", "\u{0069}",
            "\u{006a}", "\u{006b}", "\u{006c}", "\u{006d}", "\u{006e}", "\u{006f}", "\u{0070}", "\u{0071}", "\u{0072}",
            "\u{0073}", "\u{0074}", "\u{0075}", "\u{0076}", "\u{0077}", "\u{0078}", "\u{0079}", "\u{007a}", "\u{00e0}",
            "\u{00e1}", "\u{00e2}", "\u{00e3}", "\u{00e4}", "\u{00e5}", "\u{00e6}", "\u{00e7}", "\u{00e8}", "\u{00e9}",
            "\u{00ea}", "\u{00eb}", "\u{00ec}", "\u{00ed}", "\u{00ee}", "\u{00ef}", "\u{00f0}", "\u{00f1}", "\u{00f2}",
            "\u{00f3}", "\u{00f4}", "\u{00f5}", "\u{00f6}", "\u{00f8}", "\u{00f9}", "\u{00fa}", "\u{00fb}", "\u{00fc}",
            "\u{00fd}", "\u{00fe}", "\u{00ff}", "\u{0101}", "\u{0103}", "\u{0105}", "\u{0107}", "\u{0109}", "\u{010b}",
            "\u{010d}", "\u{010f}", "\u{0111}", "\u{0113}", "\u{0115}", "\u{0117}", "\u{0119}", "\u{011b}", "\u{011d}",
            "\u{011f}", "\u{0121}", "\u{0123}", "\u{0125}", "\u{0127}", "\u{0129}", "\u{012b}", "\u{012d}", "\u{012f}",
            "\u{0131}", "\u{0133}", "\u{0135}", "\u{0137}", "\u{013a}", "\u{013c}", "\u{013e}", "\u{0140}", "\u{0142}",
            "\u{0144}", "\u{0146}", "\u{0148}", "\u{014b}", "\u{014d}", "\u{014f}", "\u{0151}", "\u{0153}", "\u{0155}",
            "\u{0157}", "\u{0159}", "\u{015b}", "\u{015d}", "\u{015f}", "\u{0161}", "\u{0163}", "\u{0165}", "\u{0167}",
            "\u{0169}", "\u{016b}", "\u{016d}", "\u{016f}", "\u{0171}", "\u{0173}", "\u{0175}", "\u{0177}", "\u{017a}",
            "\u{017c}", "\u{017e}", "\u{0183}", "\u{0185}", "\u{0188}", "\u{018c}", "\u{0192}", "\u{0199}", "\u{01a1}",
            "\u{01a3}", "\u{01a5}", "\u{01a8}", "\u{01ad}", "\u{01b0}", "\u{01b4}", "\u{01b6}", "\u{01b9}", "\u{01bd}",
            "\u{01c6}", "\u{01c9}", "\u{01cc}", "\u{01ce}", "\u{01d0}", "\u{01d2}", "\u{01d4}", "\u{01d6}", "\u{01d8}",
            "\u{01da}", "\u{01dc}", "\u{01df}", "\u{01e1}", "\u{01e3}", "\u{01e5}", "\u{01e7}", "\u{01e9}", "\u{01eb}",
            "\u{01ed}", "\u{01ef}", "\u{01f3}", "\u{01f5}", "\u{01fb}", "\u{01fd}", "\u{01ff}", "\u{0201}", "\u{0203}",
            "\u{0205}", "\u{0207}", "\u{0209}", "\u{020b}", "\u{020d}", "\u{020f}", "\u{0211}", "\u{0213}", "\u{0215}",
            "\u{0217}", "\u{0253}", "\u{0254}", "\u{0257}", "\u{0258}", "\u{0259}", "\u{025b}", "\u{0260}", "\u{0263}",
            "\u{0268}", "\u{0269}", "\u{026f}", "\u{0272}", "\u{0275}", "\u{0283}", "\u{0288}", "\u{028a}", "\u{028b}",
            "\u{0292}", "\u{03ac}", "\u{03ad}", "\u{03ae}", "\u{03af}", "\u{03b1}", "\u{03b2}", "\u{03b3}", "\u{03b4}",
            "\u{03b5}", "\u{03b6}", "\u{03b7}", "\u{03b8}", "\u{03b9}", "\u{03ba}", "\u{03bb}", "\u{03bc}", "\u{03bd}",
            "\u{03be}", "\u{03bf}", "\u{03c0}", "\u{03c1}", "\u{03c3}", "\u{03c4}", "\u{03c5}", "\u{03c6}", "\u{03c7}",
            "\u{03c8}", "\u{03c9}", "\u{03ca}", "\u{03cb}", "\u{03cc}", "\u{03cd}", "\u{03ce}", "\u{03e3}", "\u{03e5}",
            "\u{03e7}", "\u{03e9}", "\u{03eb}", "\u{03ed}", "\u{03ef}", "\u{0430}", "\u{0431}", "\u{0432}", "\u{0433}",
            "\u{0434}", "\u{0435}", "\u{0436}", "\u{0437}", "\u{0438}", "\u{0439}", "\u{043a}", "\u{043b}", "\u{043c}",
            "\u{043d}", "\u{043e}", "\u{043f}", "\u{0440}", "\u{0441}", "\u{0442}", "\u{0443}", "\u{0444}", "\u{0445}",
            "\u{0446}", "\u{0447}", "\u{0448}", "\u{0449}", "\u{044a}", "\u{044b}", "\u{044c}", "\u{044d}", "\u{044e}",
            "\u{044f}", "\u{0451}", "\u{0452}", "\u{0453}", "\u{0454}", "\u{0455}", "\u{0456}", "\u{0457}", "\u{0458}",
            "\u{0459}", "\u{045a}", "\u{045b}", "\u{045c}", "\u{045e}", "\u{045f}", "\u{0461}", "\u{0463}", "\u{0465}",
            "\u{0467}", "\u{0469}", "\u{046b}", "\u{046d}", "\u{046f}", "\u{0471}", "\u{0473}", "\u{0475}", "\u{0477}",
            "\u{0479}", "\u{047b}", "\u{047d}", "\u{047f}", "\u{0481}", "\u{0491}", "\u{0493}", "\u{0495}", "\u{0497}",
            "\u{0499}", "\u{049b}", "\u{049d}", "\u{049f}", "\u{04a1}", "\u{04a3}", "\u{04a5}", "\u{04a7}", "\u{04a9}",
            "\u{04ab}", "\u{04ad}", "\u{04af}", "\u{04b1}", "\u{04b3}", "\u{04b5}", "\u{04b7}", "\u{04b9}", "\u{04bb}",
            "\u{04bd}", "\u{04bf}", "\u{04c2}", "\u{04c4}", "\u{04c8}", "\u{04cc}", "\u{04d1}", "\u{04d3}", "\u{04d5}",
            "\u{04d7}", "\u{04d9}", "\u{04db}", "\u{04dd}", "\u{04df}", "\u{04e1}", "\u{04e3}", "\u{04e5}", "\u{04e7}",
            "\u{04e9}", "\u{04eb}", "\u{04ef}", "\u{04f1}", "\u{04f3}", "\u{04f5}", "\u{04f9}", "\u{0561}", "\u{0562}",
            "\u{0563}", "\u{0564}", "\u{0565}", "\u{0566}", "\u{0567}", "\u{0568}", "\u{0569}", "\u{056a}", "\u{056b}",
            "\u{056c}", "\u{056d}", "\u{056e}", "\u{056f}", "\u{0570}", "\u{0571}", "\u{0572}", "\u{0573}", "\u{0574}",
            "\u{0575}", "\u{0576}", "\u{0577}", "\u{0578}", "\u{0579}", "\u{057a}", "\u{057b}", "\u{057c}", "\u{057d}",
            "\u{057e}", "\u{057f}", "\u{0580}", "\u{0581}", "\u{0582}", "\u{0583}", "\u{0584}", "\u{0585}", "\u{0586}",
            "\u{10d0}", "\u{10d1}", "\u{10d2}", "\u{10d3}", "\u{10d4}", "\u{10d5}", "\u{10d6}", "\u{10d7}", "\u{10d8}",
            "\u{10d9}", "\u{10da}", "\u{10db}", "\u{10dc}", "\u{10dd}", "\u{10de}", "\u{10df}", "\u{10e0}", "\u{10e1}",
            "\u{10e2}", "\u{10e3}", "\u{10e4}", "\u{10e5}", "\u{10e6}", "\u{10e7}", "\u{10e8}", "\u{10e9}", "\u{10ea}",
            "\u{10eb}", "\u{10ec}", "\u{10ed}", "\u{10ee}", "\u{10ef}", "\u{10f0}", "\u{10f1}", "\u{10f2}", "\u{10f3}",
            "\u{10f4}", "\u{10f5}", "\u{1e01}", "\u{1e03}", "\u{1e05}", "\u{1e07}", "\u{1e09}", "\u{1e0b}", "\u{1e0d}",
            "\u{1e0f}", "\u{1e11}", "\u{1e13}", "\u{1e15}", "\u{1e17}", "\u{1e19}", "\u{1e1b}", "\u{1e1d}", "\u{1e1f}",
            "\u{1e21}", "\u{1e23}", "\u{1e25}", "\u{1e27}", "\u{1e29}", "\u{1e2b}", "\u{1e2d}", "\u{1e2f}", "\u{1e31}",
            "\u{1e33}", "\u{1e35}", "\u{1e37}", "\u{1e39}", "\u{1e3b}", "\u{1e3d}", "\u{1e3f}", "\u{1e41}", "\u{1e43}",
            "\u{1e45}", "\u{1e47}", "\u{1e49}", "\u{1e4b}", "\u{1e4d}", "\u{1e4f}", "\u{1e51}", "\u{1e53}", "\u{1e55}",
            "\u{1e57}", "\u{1e59}", "\u{1e5b}", "\u{1e5d}", "\u{1e5f}", "\u{1e61}", "\u{1e63}", "\u{1e65}", "\u{1e67}",
            "\u{1e69}", "\u{1e6b}", "\u{1e6d}", "\u{1e6f}", "\u{1e71}", "\u{1e73}", "\u{1e75}", "\u{1e77}", "\u{1e79}",
            "\u{1e7b}", "\u{1e7d}", "\u{1e7f}", "\u{1e81}", "\u{1e83}", "\u{1e85}", "\u{1e87}", "\u{1e89}", "\u{1e8b}",
            "\u{1e8d}", "\u{1e8f}", "\u{1e91}", "\u{1e93}", "\u{1e95}", "\u{1ea1}", "\u{1ea3}", "\u{1ea5}", "\u{1ea7}",
            "\u{1ea9}", "\u{1eab}", "\u{1ead}", "\u{1eaf}", "\u{1eb1}", "\u{1eb3}", "\u{1eb5}", "\u{1eb7}", "\u{1eb9}",
            "\u{1ebb}", "\u{1ebd}", "\u{1ebf}", "\u{1ec1}", "\u{1ec3}", "\u{1ec5}", "\u{1ec7}", "\u{1ec9}", "\u{1ecb}",
            "\u{1ecd}", "\u{1ecf}", "\u{1ed1}", "\u{1ed3}", "\u{1ed5}", "\u{1ed7}", "\u{1ed9}", "\u{1edb}", "\u{1edd}",
            "\u{1edf}", "\u{1ee1}", "\u{1ee3}", "\u{1ee5}", "\u{1ee7}", "\u{1ee9}", "\u{1eeb}", "\u{1eed}", "\u{1eef}",
            "\u{1ef1}", "\u{1ef3}", "\u{1ef5}", "\u{1ef7}", "\u{1ef9}", "\u{1f00}", "\u{1f01}", "\u{1f02}", "\u{1f03}",
            "\u{1f04}", "\u{1f05}", "\u{1f06}", "\u{1f07}", "\u{1f10}", "\u{1f11}", "\u{1f12}", "\u{1f13}", "\u{1f14}",
            "\u{1f15}", "\u{1f20}", "\u{1f21}", "\u{1f22}", "\u{1f23}", "\u{1f24}", "\u{1f25}", "\u{1f26}", "\u{1f27}",
            "\u{1f30}", "\u{1f31}", "\u{1f32}", "\u{1f33}", "\u{1f34}", "\u{1f35}", "\u{1f36}", "\u{1f37}", "\u{1f40}",
            "\u{1f41}", "\u{1f42}", "\u{1f43}", "\u{1f44}", "\u{1f45}", "\u{1f51}", "\u{1f53}", "\u{1f55}", "\u{1f57}",
            "\u{1f60}", "\u{1f61}", "\u{1f62}", "\u{1f63}", "\u{1f64}", "\u{1f65}", "\u{1f66}", "\u{1f67}", "\u{1f80}",
            "\u{1f81}", "\u{1f82}", "\u{1f83}", "\u{1f84}", "\u{1f85}", "\u{1f86}", "\u{1f87}", "\u{1f90}", "\u{1f91}",
            "\u{1f92}", "\u{1f93}", "\u{1f94}", "\u{1f95}", "\u{1f96}", "\u{1f97}", "\u{1fa0}", "\u{1fa1}", "\u{1fa2}",
            "\u{1fa3}", "\u{1fa4}", "\u{1fa5}", "\u{1fa6}", "\u{1fa7}", "\u{1fb0}", "\u{1fb1}", "\u{1fd0}", "\u{1fd1}",
            "\u{1fe0}", "\u{1fe1}", "\u{24d0}", "\u{24d1}", "\u{24d2}", "\u{24d3}", "\u{24d4}", "\u{24d5}", "\u{24d6}",
            "\u{24d7}", "\u{24d8}", "\u{24d9}", "\u{24da}", "\u{24db}", "\u{24dc}", "\u{24dd}", "\u{24de}", "\u{24df}",
            "\u{24e0}", "\u{24e1}", "\u{24e2}", "\u{24e3}", "\u{24e4}", "\u{24e5}", "\u{24e6}", "\u{24e7}", "\u{24e8}",
            "\u{24e9}", "\u{ff41}", "\u{ff42}", "\u{ff43}", "\u{ff44}", "\u{ff45}", "\u{ff46}", "\u{ff47}", "\u{ff48}",
            "\u{ff49}", "\u{ff4a}", "\u{ff4b}", "\u{ff4c}", "\u{ff4d}", "\u{ff4e}", "\u{ff4f}", "\u{ff50}", "\u{ff51}",
            "\u{ff52}", "\u{ff53}", "\u{ff54}", "\u{ff55}", "\u{ff56}", "\u{ff57}", "\u{ff58}", "\u{ff59}", "\u{ff5a}",
            null,
        ],
        'upper' => [
            "\u{0041}", "\u{0042}", "\u{0043}", "\u{0044}", "\u{0045}", "\u{0046}", "\u{0047}", "\u{0048}", "\u{0049}",
            "\u{004a}", "\u{004b}", "\u{004c}", "\u{004d}", "\u{004e}", "\u{004f}", "\u{0050}", "\u{0051}", "\u{0052}",
            "\u{0053}", "\u{0054}", "\u{0055}", "\u{0056}", "\u{0057}", "\u{0058}", "\u{0059}", "\u{005a}", "\u{00c0}",
            "\u{00c1}", "\u{00c2}", "\u{00c3}", "\u{00c4}", "\u{00c5}", "\u{00c6}", "\u{00c7}", "\u{00c8}", "\u{00c9}",
            "\u{00ca}", "\u{00cb}", "\u{00cc}", "\u{00cd}", "\u{00ce}", "\u{00cf}", "\u{00d0}", "\u{00d1}", "\u{00d2}",
            "\u{00d3}", "\u{00d4}", "\u{00d5}", "\u{00d6}", "\u{00d8}", "\u{00d9}", "\u{00da}", "\u{00db}", "\u{00dc}",
            "\u{00dd}", "\u{00de}", "\u{0178}", "\u{0100}", "\u{0102}", "\u{0104}", "\u{0106}", "\u{0108}", "\u{010a}",
            "\u{010c}", "\u{010e}", "\u{0110}", "\u{0112}", "\u{0114}", "\u{0116}", "\u{0118}", "\u{011a}", "\u{011c}",
            "\u{011e}", "\u{0120}", "\u{0122}", "\u{0124}", "\u{0126}", "\u{0128}", "\u{012a}", "\u{012c}", "\u{012e}",
            "\u{0049}", "\u{0132}", "\u{0134}", "\u{0136}", "\u{0139}", "\u{013b}", "\u{013d}", "\u{013f}", "\u{0141}",
            "\u{0143}", "\u{0145}", "\u{0147}", "\u{014a}", "\u{014c}", "\u{014e}", "\u{0150}", "\u{0152}", "\u{0154}",
            "\u{0156}", "\u{0158}", "\u{015a}", "\u{015c}", "\u{015e}", "\u{0160}", "\u{0162}", "\u{0164}", "\u{0166}",
            "\u{0168}", "\u{016a}", "\u{016c}", "\u{016e}", "\u{0170}", "\u{0172}", "\u{0174}", "\u{0176}", "\u{0179}",
            "\u{017b}", "\u{017d}", "\u{0182}", "\u{0184}", "\u{0187}", "\u{018b}", "\u{0191}", "\u{0198}", "\u{01a0}",
            "\u{01a2}", "\u{01a4}", "\u{01a7}", "\u{01ac}", "\u{01af}", "\u{01b3}", "\u{01b5}", "\u{01b8}", "\u{01bc}",
            "\u{01c4}", "\u{01c7}", "\u{01ca}", "\u{01cd}", "\u{01cf}", "\u{01d1}", "\u{01d3}", "\u{01d5}", "\u{01d7}",
            "\u{01d9}", "\u{01db}", "\u{01de}", "\u{01e0}", "\u{01e2}", "\u{01e4}", "\u{01e6}", "\u{01e8}", "\u{01ea}",
            "\u{01ec}", "\u{01ee}", "\u{01f1}", "\u{01f4}", "\u{01fa}", "\u{01fc}", "\u{01fe}", "\u{0200}", "\u{0202}",
            "\u{0204}", "\u{0206}", "\u{0208}", "\u{020a}", "\u{020c}", "\u{020e}", "\u{0210}", "\u{0212}", "\u{0214}",
            "\u{0216}", "\u{0181}", "\u{0186}", "\u{018a}", "\u{018e}", "\u{018f}", "\u{0190}", "\u{0193}", "\u{0194}",
            "\u{0197}", "\u{0196}", "\u{019c}", "\u{019d}", "\u{019f}", "\u{01a9}", "\u{01ae}", "\u{01b1}", "\u{01b2}",
            "\u{01b7}", "\u{0386}", "\u{0388}", "\u{0389}", "\u{038a}", "\u{0391}", "\u{0392}", "\u{0393}", "\u{0394}",
            "\u{0395}", "\u{0396}", "\u{0397}", "\u{0398}", "\u{0399}", "\u{039a}", "\u{039b}", "\u{039c}", "\u{039d}",
            "\u{039e}", "\u{039f}", "\u{03a0}", "\u{03a1}", "\u{03a3}", "\u{03a4}", "\u{03a5}", "\u{03a6}", "\u{03a7}",
            "\u{03a8}", "\u{03a9}", "\u{03aa}", "\u{03ab}", "\u{038c}", "\u{038e}", "\u{038f}", "\u{03e2}", "\u{03e4}",
            "\u{03e6}", "\u{03e8}", "\u{03ea}", "\u{03ec}", "\u{03ee}", "\u{0410}", "\u{0411}", "\u{0412}", "\u{0413}",
            "\u{0414}", "\u{0415}", "\u{0416}", "\u{0417}", "\u{0418}", "\u{0419}", "\u{041a}", "\u{041b}", "\u{041c}",
            "\u{041d}", "\u{041e}", "\u{041f}", "\u{0420}", "\u{0421}", "\u{0422}", "\u{0423}", "\u{0424}", "\u{0425}",
            "\u{0426}", "\u{0427}", "\u{0428}", "\u{0429}", "\u{042a}", "\u{042b}", "\u{042c}", "\u{042d}", "\u{042e}",
            "\u{042f}", "\u{0401}", "\u{0402}", "\u{0403}", "\u{0404}", "\u{0405}", "\u{0406}", "\u{0407}", "\u{0408}",
            "\u{0409}", "\u{040a}", "\u{040b}", "\u{040c}", "\u{040e}", "\u{040f}", "\u{0460}", "\u{0462}", "\u{0464}",
            "\u{0466}", "\u{0468}", "\u{046a}", "\u{046c}", "\u{046e}", "\u{0470}", "\u{0472}", "\u{0474}", "\u{0476}",
            "\u{0478}", "\u{047a}", "\u{047c}", "\u{047e}", "\u{0480}", "\u{0490}", "\u{0492}", "\u{0494}", "\u{0496}",
            "\u{0498}", "\u{049a}", "\u{049c}", "\u{049e}", "\u{04a0}", "\u{04a2}", "\u{04a4}", "\u{04a6}", "\u{04a8}",
            "\u{04aa}", "\u{04ac}", "\u{04ae}", "\u{04b0}", "\u{04b2}", "\u{04b4}", "\u{04b6}", "\u{04b8}", "\u{04ba}",
            "\u{04bc}", "\u{04be}", "\u{04c1}", "\u{04c3}", "\u{04c7}", "\u{04cb}", "\u{04d0}", "\u{04d2}", "\u{04d4}",
            "\u{04d6}", "\u{04d8}", "\u{04da}", "\u{04dc}", "\u{04de}", "\u{04e0}", "\u{04e2}", "\u{04e4}", "\u{04e6}",
            "\u{04e8}", "\u{04ea}", "\u{04ee}", "\u{04f0}", "\u{04f2}", "\u{04f4}", "\u{04f8}", "\u{0531}", "\u{0532}",
            "\u{0533}", "\u{0534}", "\u{0535}", "\u{0536}", "\u{0537}", "\u{0538}", "\u{0539}", "\u{053a}", "\u{053b}",
            "\u{053c}", "\u{053d}", "\u{053e}", "\u{053f}", "\u{0540}", "\u{0541}", "\u{0542}", "\u{0543}", "\u{0544}",
            "\u{0545}", "\u{0546}", "\u{0547}", "\u{0548}", "\u{0549}", "\u{054a}", "\u{054b}", "\u{054c}", "\u{054d}",
            "\u{054e}", "\u{054f}", "\u{0550}", "\u{0551}", "\u{0552}", "\u{0553}", "\u{0554}", "\u{0555}", "\u{0556}",
            "\u{10a0}", "\u{10a1}", "\u{10a2}", "\u{10a3}", "\u{10a4}", "\u{10a5}", "\u{10a6}", "\u{10a7}", "\u{10a8}",
            "\u{10a9}", "\u{10aa}", "\u{10ab}", "\u{10ac}", "\u{10ad}", "\u{10ae}", "\u{10af}", "\u{10b0}", "\u{10b1}",
            "\u{10b2}", "\u{10b3}", "\u{10b4}", "\u{10b5}", "\u{10b6}", "\u{10b7}", "\u{10b8}", "\u{10b9}", "\u{10ba}",
            "\u{10bb}", "\u{10bc}", "\u{10bd}", "\u{10be}", "\u{10bf}", "\u{10c0}", "\u{10c1}", "\u{10c2}", "\u{10c3}",
            "\u{10c4}", "\u{10c5}", "\u{1e00}", "\u{1e02}", "\u{1e04}", "\u{1e06}", "\u{1e08}", "\u{1e0a}", "\u{1e0c}",
            "\u{1e0e}", "\u{1e10}", "\u{1e12}", "\u{1e14}", "\u{1e16}", "\u{1e18}", "\u{1e1a}", "\u{1e1c}", "\u{1e1e}",
            "\u{1e20}", "\u{1e22}", "\u{1e24}", "\u{1e26}", "\u{1e28}", "\u{1e2a}", "\u{1e2c}", "\u{1e2e}", "\u{1e30}",
            "\u{1e32}", "\u{1e34}", "\u{1e36}", "\u{1e38}", "\u{1e3a}", "\u{1e3c}", "\u{1e3e}", "\u{1e40}", "\u{1e42}",
            "\u{1e44}", "\u{1e46}", "\u{1e48}", "\u{1e4a}", "\u{1e4c}", "\u{1e4e}", "\u{1e50}", "\u{1e52}", "\u{1e54}",
            "\u{1e56}", "\u{1e58}", "\u{1e5a}", "\u{1e5c}", "\u{1e5e}", "\u{1e60}", "\u{1e62}", "\u{1e64}", "\u{1e66}",
            "\u{1e68}", "\u{1e6a}", "\u{1e6c}", "\u{1e6e}", "\u{1e70}", "\u{1e72}", "\u{1e74}", "\u{1e76}", "\u{1e78}",
            "\u{1e7a}", "\u{1e7c}", "\u{1e7e}", "\u{1e80}", "\u{1e82}", "\u{1e84}", "\u{1e86}", "\u{1e88}", "\u{1e8a}",
            "\u{1e8c}", "\u{1e8e}", "\u{1e90}", "\u{1e92}", "\u{1e94}", "\u{1ea0}", "\u{1ea2}", "\u{1ea4}", "\u{1ea6}",
            "\u{1ea8}", "\u{1eaa}", "\u{1eac}", "\u{1eae}", "\u{1eb0}", "\u{1eb2}", "\u{1eb4}", "\u{1eb6}", "\u{1eb8}",
            "\u{1eba}", "\u{1ebc}", "\u{1ebe}", "\u{1ec0}", "\u{1ec2}", "\u{1ec4}", "\u{1ec6}", "\u{1ec8}", "\u{1eca}",
            "\u{1ecc}", "\u{1ece}", "\u{1ed0}", "\u{1ed2}", "\u{1ed4}", "\u{1ed6}", "\u{1ed8}", "\u{1eda}", "\u{1edc}",
            "\u{1ede}", "\u{1ee0}", "\u{1ee2}", "\u{1ee4}", "\u{1ee6}", "\u{1ee8}", "\u{1eea}", "\u{1eec}", "\u{1eee}",
            "\u{1ef0}", "\u{1ef2}", "\u{1ef4}", "\u{1ef6}", "\u{1ef8}", "\u{1f08}", "\u{1f09}", "\u{1f0a}", "\u{1f0b}",
            "\u{1f0c}", "\u{1f0d}", "\u{1f0e}", "\u{1f0f}", "\u{1f18}", "\u{1f19}", "\u{1f1a}", "\u{1f1b}", "\u{1f1c}",
            "\u{1f1d}", "\u{1f28}", "\u{1f29}", "\u{1f2a}", "\u{1f2b}", "\u{1f2c}", "\u{1f2d}", "\u{1f2e}", "\u{1f2f}",
            "\u{1f38}", "\u{1f39}", "\u{1f3a}", "\u{1f3b}", "\u{1f3c}", "\u{1f3d}", "\u{1f3e}", "\u{1f3f}", "\u{1f48}",
            "\u{1f49}", "\u{1f4a}", "\u{1f4b}", "\u{1f4c}", "\u{1f4d}", "\u{1f59}", "\u{1f5b}", "\u{1f5d}", "\u{1f5f}",
            "\u{1f68}", "\u{1f69}", "\u{1f6a}", "\u{1f6b}", "\u{1f6c}", "\u{1f6d}", "\u{1f6e}", "\u{1f6f}", "\u{1f88}",
            "\u{1f89}", "\u{1f8a}", "\u{1f8b}", "\u{1f8c}", "\u{1f8d}", "\u{1f8e}", "\u{1f8f}", "\u{1f98}", "\u{1f99}",
            "\u{1f9a}", "\u{1f9b}", "\u{1f9c}", "\u{1f9d}", "\u{1f9e}", "\u{1f9f}", "\u{1fa8}", "\u{1fa9}", "\u{1faa}",
            "\u{1fab}", "\u{1fac}", "\u{1fad}", "\u{1fae}", "\u{1faf}", "\u{1fb8}", "\u{1fb9}", "\u{1fd8}", "\u{1fd9}",
            "\u{1fe8}", "\u{1fe9}", "\u{24b6}", "\u{24b7}", "\u{24b8}", "\u{24b9}", "\u{24ba}", "\u{24bb}", "\u{24bc}",
            "\u{24bd}", "\u{24be}", "\u{24bf}", "\u{24c0}", "\u{24c1}", "\u{24c2}", "\u{24c3}", "\u{24c4}", "\u{24c5}",
            "\u{24c6}", "\u{24c7}", "\u{24c8}", "\u{24c9}", "\u{24ca}", "\u{24cb}", "\u{24cc}", "\u{24cd}", "\u{24ce}",
            "\u{24cf}", "\u{ff21}", "\u{ff22}", "\u{ff23}", "\u{ff24}", "\u{ff25}", "\u{ff26}", "\u{ff27}", "\u{ff28}",
            "\u{ff29}", "\u{ff2a}", "\u{ff2b}", "\u{ff2c}", "\u{ff2d}", "\u{ff2e}", "\u{ff2f}", "\u{ff30}", "\u{ff31}",
            "\u{ff32}", "\u{ff33}", "\u{ff34}", "\u{ff35}", "\u{ff36}", "\u{ff37}", "\u{ff38}", "\u{ff39}", "\u{ff3a}",
            null,
        ],
    ];

    public function evaluate($scope)
    {
        $this->Expr->checkEvaluationLimits($this);

        $input = $this->arguments[0]->evaluate($scope);

        if (Typing::isNull($input)) {
            return null;
        } elseif (Typing::isString($input)) {
            return mb_strtoupper($input);
        } else {
            throw new Exception('fn6 :: upper,' . Typing::getType($input));
        }
    }

    public function toMongoExpression(array $localVariables, array $fieldNames, array $options)
    {
        throw new Exception('This function is not suppoerted in DB yet');

        // Вот этот вариант рабочий, но очень, очень медленный :(
        return [
            '$let' => [
                'vars' => [
                    'input' => $this->arguments[0]->toMongoExpression($localVariables, $fieldNames, $options),
                    'table_upper' => self::$TABLE['upper'],
                    'table_lower' => self::$TABLE['lower'],
                ],
                'in' => [
                    '$switch' => [
                        'branches' => [[
                            'case' => ['$eq' => ['$$input', null]],
                            'then' => null,
                        ], [
                            'case' => ['$eq' => [['$type' => '$$input'], 'string']],
                            'then' => [
                                '$reduce' => [
                                    'input' => ['$range' => [0, ['$strLenCP' => '$$input']]],
                                    'in' => [
                                        '$concat' => ['$$value', [
                                            '$ifNull' => [[
                                                '$arrayElemAt' => ['$$table_upper', [
                                                    '$indexOfArray' => ['$$table_lower', [
                                                        '$substrCP' => ['$$input', '$$this', 1]
                                                    ]]
                                                ]]
                                            ], ['$substrCP' => ['$$input', '$$this', 1]]]
                                        ]]
                                    ],
                                    'initialValue' => '',
                                ]
                            ],
                        ]],
                        'default' => [
                            '$dateFromString' => [
                                'dateString' => '$_this_is_missing',
                                'format' => [[
                                    '$concat' => ['_throw_ upper1,', ['$type' => '$$input']],
                                ]],
                            ],
                        ],
                    ],
                ],
            ],
        ];
    }
}